<div class="editor-page">

  <header class="editor-top d-flex justify-content-between align-items-center mb-3">

    <div class="d-flex align-items-center gap-3">
      <button type="button"
        class="btn btn-light rounded-circle border d-inline-flex align-items-center justify-content-center"
        aria-label="Back" (click)="goBack()" style="width:36px;height:36px;">
        <i class="bi bi-arrow-left"></i>
      </button>

      <div class="d-flex flex-column">
        <span class="fw-semibold">
          {{ currentDraftId() ? 'Editing draft' : 'New article' }}
        </span>
        <span class="text-muted small">
          {{ currentDraftId() ? ('Draft #' + currentDraftId()) : 'Start writing your story' }}
        </span>
      </div>
    </div>

    <div class="d-flex align-items-center gap-2">
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="newArticle()">New Articel</button>
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="saveDraft()">
        <span *ngIf="!isSavingDraft(); else savingTpl">Save draft</span>
        <ng-template #savingTpl>Saving…</ng-template>
      </button>
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="openPreview()">Preview</button>
      <button type="button" class="btn btn-primary btn-sm" (click)="publishArticle()">Publish</button>
    </div>
  </header>



  <main class="editor-body">
    <section class="editor-main">

      <div class="mb-4">
        <div class="text-uppercase text-muted tiny-label mb-2">Announcement</div>
        <input class="editor-title form-control-plaintext fw-bold" [(ngModel)]="title"
          placeholder="My first article..." />

        <div class="d-flex align-items-center mt-3 gap-2">
          <select class="form-select form-select-sm w-auto" [(ngModel)]="category">
            <option value="">Select categories</option>
            <option value="Tech">Tech</option>
            <option value="Productivity">Productivity</option>
            <option value="Wellbeing">Wellbeing</option>
          </select>
          <button class="btn btn-outline-secondary btn-sm" type="button">Settings</button>
        </div>
      </div>


      <div class="mb-5">
        <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"></ngx-editor-menu>
        <ngx-editor class="editor-box mt-1" [editor]="editor" [placeholder]="'Write your story...'"
          [(ngModel)]="content">
        </ngx-editor>
      </div>


      <div class="mb-5 text-center">
        <div class="media-card">
          <ng-container *ngIf="!coverImage; else mediaPreview">
            <div class="media-placeholder d-flex flex-column align-items-center justify-content-center">
              <i class="bi bi-card-image fs-2 text-muted mb-2"></i>
              <button class="btn btn-outline-secondary btn-sm" type="button">
                <label class="mb-0">
                  Add image / video
                  <input type="file" accept="image/*,video/*" hidden (change)="onCoverSelected($event)" />
                </label>
              </button>
            </div>
          </ng-container>
          <ng-template #mediaPreview>
            <img [src]="coverImage" class="img-fluid rounded" />
            <div class="mt-2">
              <button class="btn btn-outline-secondary btn-sm me-2" type="button">
                <label class="mb-0">
                  Change media
                  <input type="file" accept="image/*,video/*" hidden (change)="onCoverSelected($event)" />
                </label>
              </button>
              <button class="btn btn-link btn-sm text-danger" type="button" (click)="coverImage = null">
                Remove
              </button>
            </div>
          </ng-template>
        </div>
        <div class="small text-muted mt-1">Press Space to add picture.</div>
      </div>


      <section class="schedule-card mb-5">
        <div class="form-check form-switch mb-2">
          <input class="form-check-input" type="checkbox" [checked]="scheduleEnabled()"
            (change)="scheduleEnabled.set($any($event.target).checked)" />
          <label class="form-check-label">Schedule this post</label>
        </div>
        <div class="d-flex align-items-center gap-2" *ngIf="scheduleEnabled()">
          <input type="datetime-local" class="form-control form-control-sm w-auto" [ngModel]="scheduledAt()"
            (ngModelChange)="scheduledAt.set($event)" />
          <button class="btn btn-outline-secondary btn-sm" type="button" (click)="schedulePost()"
            [disabled]="!scheduledAt()">
            Schedule
          </button>
        </div>
      </section>
    </section>
    <aside class="drafts-sidebar">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="fw-semibold mb-0">My drafts</h6>
        <button class="btn btn-link btn-sm p-0" type="button" (click)="startNewDraft()">
          + New
        </button>
      </div>

      <div *ngFor="let d of userDrafts()" class="draft-item" [class.active]="d.id === currentDraftId()"
        (click)="loadDraft(d.id)">
        <div class="draft-title text-truncate">{{ d.title || 'Untitled draft' }}</div>
        <div class="draft-meta small text-muted">
          {{ d.category || 'No category' }} • {{ d.updatedAt | date:'short' }}
        </div>
      </div>
    </aside>
  </main>
</div>
<app-preview-modal></app-preview-modal>